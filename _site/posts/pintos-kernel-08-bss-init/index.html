<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh-CN" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Pintos Kernel 启动详解（八）：BSS 段初始化" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="详细解析 BSS 段的概念、为什么需要手动清零、以及 Pintos 的 bss_init() 函数实现。" />
<meta property="og:description" content="详细解析 BSS 段的概念、为什么需要手动清零、以及 Pintos 的 bss_init() 函数实现。" />
<link rel="canonical" href="http://localhost:4000/posts/pintos-kernel-08-bss-init/" />
<meta property="og:url" content="http://localhost:4000/posts/pintos-kernel-08-bss-init/" />
<meta property="og:site_name" content="Zxsheather" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2026-01-22T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Pintos Kernel 启动详解（八）：BSS 段初始化" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2026-01-22T00:00:00+08:00","datePublished":"2026-01-22T00:00:00+08:00","description":"详细解析 BSS 段的概念、为什么需要手动清零、以及 Pintos 的 bss_init() 函数实现。","headline":"Pintos Kernel 启动详解（八）：BSS 段初始化","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/pintos-kernel-08-bss-init/"},"url":"http://localhost:4000/posts/pintos-kernel-08-bss-init/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Pintos Kernel 启动详解（八）：BSS 段初始化 | Zxsheather
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">



  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/zh.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js,npm/mermaid@11.12.0/dist/mermaid.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/3.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">Zxsheather</a>
    <p class="site-subtitle fst-italic mb-0">A CS Undergraduate</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>首页</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>分类</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>标签</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>归档</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>关于</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
    

    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">首页</a>
            </span>

          
        
          
        
          
            
              <span>Pintos Kernel 启动详解（八）：BSS 段初始化</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      文章
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="搜索..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">取消</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>Pintos Kernel 启动详解（八）：BSS 段初始化</h1>
    
      <p class="post-desc fw-light mb-4">详细解析 BSS 段的概念、为什么需要手动清零、以及 Pintos 的 bss_init() 函数实现。</p>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        发表于
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1769011200"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2026/01/22
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          作者

          <em>
            
              <a href="https://github.com/zxsheather">Zxsheather</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2940 字"
>
  <em>16 分钟</em>阅读</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">Pintos Kernel 启动详解（八）：BSS 段初始化</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">文章内容</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">Pintos Kernel 启动详解（八）：BSS 段初始化</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <h2 id="概述"><span class="me-2">概述</span><a href="#概述" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>BSS（Block Started by Symbol）段是程序中存放未初始化全局变量和静态变量的区域。在 <code class="language-plaintext highlighter-rouge">pintos_init()</code> 的第一步就是调用 <code class="language-plaintext highlighter-rouge">bss_init()</code> 来清零这个区域。</p>

<p>这是一个看似简单但极其重要的步骤——如果 BSS 没有正确清零，所有未初始化的全局变量都可能包含随机垃圾数据，导致不可预测的系统行为。</p>

<hr />

<h2 id="原始代码"><span class="me-2">原始代码</span><a href="#原始代码" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="cm">/** Clear the "BSS", a segment that should be initialized to
   zeros.  It isn't actually stored on disk or zeroed by the
   kernel loader, so we have to zero it ourselves.

   The start and end of the BSS segment is recorded by the
   linker as _start_bss and _end_bss.  See kernel.lds. */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">bss_init</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="k">extern</span> <span class="kt">char</span> <span class="n">_start_bss</span><span class="p">,</span> <span class="n">_end_bss</span><span class="p">;</span>
  <span class="n">memset</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">_start_bss</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_end_bss</span> <span class="o">-</span> <span class="o">&amp;</span><span class="n">_start_bss</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<hr />

<h2 id="前置知识"><span class="me-2">前置知识</span><a href="#前置知识" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="程序的内存布局"><span class="me-2">程序的内存布局</span><a href="#程序的内存布局" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>一个典型的程序在内存中分为几个段：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre>┌─────────────────────────────────────────────────────────────┐
│                    程序内存布局                               │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  高地址 ↑                                                    │
│                                                              │
│  ┌──────────────┐                                           │
│  │    Stack     │  栈：局部变量、函数调用帧                   │
│  │      ↓       │  向下增长                                  │
│  ├──────────────┤                                           │
│  │              │  未使用空间                                │
│  │      ↑       │                                           │
│  │    Heap      │  堆：动态分配的内存                        │
│  ├──────────────┤                                           │
│  │    .bss      │  未初始化的全局/静态变量                   │
│  ├──────────────┤                                           │
│  │    .data     │  初始化的全局/静态变量                     │
│  ├──────────────┤                                           │
│  │   .rodata    │  只读数据（字符串常量等）                  │
│  ├──────────────┤                                           │
│  │    .text     │  程序代码                                  │
│  └──────────────┘                                           │
│                                                              │
│  低地址 ↓                                                    │
│                                                              │
└─────────────────────────────────────────────────────────────┘
</pre></td></tr></tbody></table></code></div></div>

<h3 id="data-vs-bss"><span class="me-2">.data vs .bss</span><a href="#data-vs-bss" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c1">// 这些变量在 .data 段</span>
<span class="kt">int</span> <span class="n">initialized_global</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">initialized_static</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">message</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"Hello"</span><span class="p">;</span>

<span class="c1">// 这些变量在 .bss 段</span>
<span class="kt">int</span> <span class="n">uninitialized_global</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">uninitialized_static</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>  <span class="c1">// 初始化为 0 的数组也在 .bss</span>
<span class="kt">int</span> <span class="n">zero_initialized</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// 显式初始化为 0 也可能在 .bss</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="为什么要分开-data-和-bss"><span class="me-2">为什么要分开 .data 和 .bss？</span><a href="#为什么要分开-data-和-bss" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p><strong>关键原因：节省文件空间！</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>.data 段：
    - 变量有初始值
    - 这些初始值必须存储在可执行文件中
    - 加载时原样复制到内存

.bss 段：
    - 所有变量初始值都是 0
    - 可执行文件中不需要存储这些 0
    - 只需要记录 .bss 的大小
    - 加载时分配空间并清零
</pre></td></tr></tbody></table></code></div></div>

<p><strong>文件大小对比示例</strong></p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="kt">int</span> <span class="n">big_array</span><span class="p">[</span><span class="mi">1000000</span><span class="p">];</span>           <span class="c1">// 4 MB 数组</span>

<span class="c1">// 如果在 .data 段：</span>
<span class="c1">// 可执行文件大小 += 4 MB（存储 1000000 个 0）</span>

<span class="c1">// 如果在 .bss 段：</span>
<span class="c1">// 可执行文件大小 += 几字节（只存储大小信息）</span>
</pre></td></tr></tbody></table></code></div></div>

<hr />

<h2 id="elf-文件格式与段"><span class="me-2">ELF 文件格式与段</span><a href="#elf-文件格式与段" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="elf-头中的段信息"><span class="me-2">ELF 头中的段信息</span><a href="#elf-头中的段信息" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>ELF 文件结构：

┌──────────────────────┐
│      ELF Header      │  文件类型、入口点等
├──────────────────────┤
│   Program Headers    │  描述如何加载到内存
├──────────────────────┤
│      .text           │  代码段（实际数据）
├──────────────────────┤
│      .rodata         │  只读数据（实际数据）
├──────────────────────┤
│      .data           │  数据段（实际数据）
├──────────────────────┤
│      .bss            │  ← 只有头信息，没有实际数据！
├──────────────────────┤
│   Section Headers    │  描述各段的属性
└──────────────────────┘
</pre></td></tr></tbody></table></code></div></div>

<h3 id="bss-段在文件中不占空间"><span class="me-2">.bss 段在文件中不占空间</span><a href="#bss-段在文件中不占空间" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>使用 readelf 查看段信息：

$ readelf -S kernel.o

Section Headers:
  [Nr] Name    Type      Address   Offset  Size    ...
  ...
  [10] .data   PROGBITS  c0020000  001000  000234  ...  ← 有内容
  [11] .bss    NOBITS    c0020234  001234  001000  ...  ← 无内容！
  ...

NOBITS 类型表示段在文件中没有数据，只有大小信息
</pre></td></tr></tbody></table></code></div></div>

<hr />

<h2 id="pintos-的内核加载过程"><span class="me-2">Pintos 的内核加载过程</span><a href="#pintos-的内核加载过程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="loader-的限制"><span class="me-2">Loader 的限制</span><a href="#loader-的限制" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Pintos 的 Loader 是一个简化的引导加载器，它：</p>

<ol>
  <li>读取 ELF 头获取加载信息</li>
  <li>将各段从磁盘复制到内存</li>
  <li><strong>但不会清零 .bss 段！</strong></li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>Loader 的工作：

磁盘上的内核 ELF 文件           内存中的内核映像
┌────────────┐                ┌────────────┐
│ ELF Header │────读取────→   │            │
├────────────┤                │            │
│   .text    │────复制────→   │   .text    │
├────────────┤                ├────────────┤
│   .data    │────复制────→   │   .data    │
├────────────┤                ├────────────┤
│            │                │   .bss     │ ← 分配了空间
│            │   （无数据）     │  (垃圾?)   │    但没有清零！
└────────────┘                └────────────┘
</pre></td></tr></tbody></table></code></div></div>

<h3 id="为什么-loader-不清零-bss"><span class="me-2">为什么 Loader 不清零 BSS？</span><a href="#为什么-loader-不清零-bss" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ol>
  <li><strong>简化 Loader</strong>：Loader 代码越少越好（只有 512 字节）</li>
  <li><strong>灵活性</strong>：让内核自己处理 BSS 初始化</li>
  <li><strong>历史原因</strong>：很多系统都是内核自己清零 BSS</li>
</ol>

<hr />

<h2 id="bss_init-详解"><span class="me-2">bss_init() 详解</span><a href="#bss_init-详解" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="代码分析"><span class="me-2">代码分析</span><a href="#代码分析" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">static</span> <span class="kt">void</span>
<span class="nf">bss_init</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="k">extern</span> <span class="kt">char</span> <span class="n">_start_bss</span><span class="p">,</span> <span class="n">_end_bss</span><span class="p">;</span>
  <span class="n">memset</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">_start_bss</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_end_bss</span> <span class="o">-</span> <span class="o">&amp;</span><span class="n">_start_bss</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="链接器符号"><span class="me-2">链接器符号</span><a href="#链接器符号" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">extern</span> <span class="kt">char</span> <span class="n">_start_bss</span><span class="p">,</span> <span class="n">_end_bss</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>这两个符号不是普通变量，而是<strong>链接器定义的符号</strong>。</p>

<p><strong>在 kernel.lds.S 中定义：</strong></p>

<pre><code class="language-ld">SECTIONS
{
  ...
  
  .bss : {
    _start_bss = .;        /* BSS 开始地址 */
    *(.bss)                /* 收集所有 .bss 输入段 */
    *(COMMON)              /* 收集 COMMON 符号 */
    _end_bss = .;          /* BSS 结束地址 */
  }
  
  ...
}
</code></pre>

<p><strong>符号的含义</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>_start_bss：BSS 段第一个字节的地址
_end_bss：BSS 段最后一个字节之后的地址

BSS 大小 = &amp;_end_bss - &amp;_start_bss
</pre></td></tr></tbody></table></code></div></div>

<h3 id="为什么用-char-类型"><span class="me-2">为什么用 char 类型？</span><a href="#为什么用-char-类型" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">extern</span> <span class="kt">char</span> <span class="n">_start_bss</span><span class="p">,</span> <span class="n">_end_bss</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>这是一个技巧：</p>

<ol>
  <li>我们只关心这些符号的<strong>地址</strong></li>
  <li>用 <code class="language-plaintext highlighter-rouge">char</code> 类型可以方便地进行地址算术</li>
  <li><code class="language-plaintext highlighter-rouge">&amp;_start_bss</code> 得到 <code class="language-plaintext highlighter-rouge">char *</code> 类型</li>
  <li>两个 <code class="language-plaintext highlighter-rouge">char *</code> 相减得到字节数</li>
</ol>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">// 这样就可以计算字节数：</span>
<span class="kt">size_t</span> <span class="n">bss_size</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">_end_bss</span> <span class="o">-</span> <span class="o">&amp;</span><span class="n">_start_bss</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="memset-调用"><span class="me-2">memset 调用</span><a href="#memset-调用" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">memset</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">_start_bss</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_end_bss</span> <span class="o">-</span> <span class="o">&amp;</span><span class="n">_start_bss</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>memset 函数原型：
void *memset(void *s, int c, size_t n);

参数：
    &amp;_start_bss         - BSS 起始地址
    0                   - 要填充的值（0）
    &amp;_end_bss - &amp;_start_bss  - BSS 大小（字节）

效果：将 BSS 段的每个字节都设置为 0
</pre></td></tr></tbody></table></code></div></div>

<hr />

<h2 id="执行流程可视化"><span class="me-2">执行流程可视化</span><a href="#执行流程可视化" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<pre><code class="language-mermaid">flowchart TD
    A["内核被加载到内存"] --&gt; B["BSS 区域包含垃圾数据"]
    B --&gt; C["pintos_init() 开始"]
    C --&gt; D["bss_init() 被调用"]
    D --&gt; E["获取 _start_bss 地址"]
    E --&gt; F["获取 _end_bss 地址"]
    F --&gt; G["计算 BSS 大小"]
    G --&gt; H["memset 清零整个 BSS"]
    H --&gt; I["所有全局变量现在为 0"]
    I --&gt; J["继续初始化其他子系统"]
    
    style B fill:#f99,stroke:#333
    style I fill:#9f9,stroke:#333
</code></pre>

<hr />

<h2 id="bss-中的变量示例"><span class="me-2">BSS 中的变量示例</span><a href="#bss-中的变量示例" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="pintos-中的-bss-变量"><span class="me-2">Pintos 中的 BSS 变量</span><a href="#pintos-中的-bss-变量" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1">// threads/thread.c</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">list</span> <span class="n">ready_list</span><span class="p">;</span>      <span class="c1">// 就绪队列</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">list</span> <span class="n">all_list</span><span class="p">;</span>        <span class="c1">// 所有线程列表</span>
<span class="k">static</span> <span class="k">struct</span> <span class="kr">thread</span> <span class="o">*</span><span class="n">idle_thread</span><span class="p">;</span>  <span class="c1">// 空闲线程指针</span>

<span class="c1">// threads/palloc.c</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">pool</span> <span class="n">kernel_pool</span><span class="p">;</span>     <span class="c1">// 内核内存池</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">pool</span> <span class="n">user_pool</span><span class="p">;</span>       <span class="c1">// 用户内存池</span>

<span class="c1">// threads/malloc.c</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">arena</span> <span class="o">*</span><span class="n">arenas</span><span class="p">;</span>        <span class="c1">// 内存分配器区域</span>
</pre></td></tr></tbody></table></code></div></div>

<p>这些变量都在 BSS 段，如果不清零：</p>
<ul>
  <li>链表头可能指向随机地址</li>
  <li>指针可能不是 NULL</li>
  <li>结构体字段包含垃圾值</li>
</ul>

<h3 id="未清零-bss-的后果"><span class="me-2">未清零 BSS 的后果</span><a href="#未清零-bss-的后果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1">// 假设这是一个 BSS 变量</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">list</span> <span class="n">my_list</span><span class="p">;</span>  <span class="c1">// 期望：{NULL, NULL}</span>
                             <span class="c1">// 实际：{0x12345678, 0x87654321} (垃圾)</span>

<span class="kt">void</span> <span class="nf">use_list</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">list_empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_list</span><span class="p">))</span> <span class="p">{</span>   <span class="c1">// 检查 head == tail</span>
        <span class="c1">// 可能错误地认为列表不为空！</span>
    <span class="p">}</span>
    
    <span class="n">list_push_front</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_list</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">elem</span><span class="p">);</span>  <span class="c1">// 可能访问无效指针！</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<hr />

<h2 id="memset-的实现"><span class="me-2">memset 的实现</span><a href="#memset-的实现" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="pintos-的-memset-libstringc"><span class="me-2">Pintos 的 memset (lib/string.c)</span><a href="#pintos-的-memset-libstringc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kt">void</span> <span class="o">*</span>
<span class="nf">memset</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">dst_</span><span class="p">,</span> <span class="kt">int</span> <span class="n">value</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dst</span> <span class="o">=</span> <span class="n">dst_</span><span class="p">;</span>

  <span class="n">ASSERT</span> <span class="p">(</span><span class="n">dst</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
  
  <span class="k">while</span> <span class="p">(</span><span class="n">size</span><span class="o">--</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="o">*</span><span class="n">dst</span><span class="o">++</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">dst_</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>这是一个简单的字节级实现。更优化的版本可能使用：</p>
<ul>
  <li>字对齐的操作</li>
  <li>SIMD 指令</li>
  <li>特殊的字符串指令（如 <code class="language-plaintext highlighter-rouge">rep stosb</code>）</li>
</ul>

<hr />

<h2 id="链接器脚本详解"><span class="me-2">链接器脚本详解</span><a href="#链接器脚本详解" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="kernelldss-的结构"><span class="me-2">kernel.lds.S 的结构</span><a href="#kernelldss-的结构" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<pre><code class="language-ld">/* Pintos 内核链接器脚本（简化版）*/

ENTRY(start)                    /* 入口点 */

SECTIONS
{
  . = LOADER_PHYS_BASE + LOADER_KERN_BASE;  /* 起始地址 */
  
  _start = .;                   /* 内核起始 */
  
  .start : {
    *(.start)                   /* start.S 代码 */
  }
  
  .text : {
    *(.text)                    /* 所有代码 */
  }
  
  .rodata : {
    *(.rodata)                  /* 只读数据 */
  }
  
  .data : {
    *(.data)                    /* 初始化数据 */
  }
  
  .bss : {
    _start_bss = .;             /* BSS 开始标记 */
    *(.bss)                     /* 未初始化数据 */
    *(COMMON)                   /* COMMON 符号 */
    _end_bss = .;               /* BSS 结束标记 */
  }
  
  _end = .;                     /* 内核结束 */
}
</code></pre>

<h3 id="common-符号是什么"><span class="me-2">COMMON 符号是什么？</span><a href="#common-符号是什么" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c1">// 在 C 语言中，未初始化的全局变量（非 static）</span>
<span class="c1">// 可能被放入 COMMON 段而不是 .bss</span>

<span class="kt">int</span> <span class="n">global_var</span><span class="p">;</span>    <span class="c1">// 可能是 COMMON</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">static_var</span><span class="p">;</span>  <span class="c1">// 一定是 .bss</span>
</pre></td></tr></tbody></table></code></div></div>

<p>COMMON 符号是为了支持多个文件定义同名变量的传统 C 行为。现代做法是将它们也收集到 .bss。</p>

<hr />

<h2 id="常见问题"><span class="me-2">常见问题</span><a href="#常见问题" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="q1-为什么不在-loader-中清零-bss"><span class="me-2">Q1: 为什么不在 Loader 中清零 BSS？</span><a href="#q1-为什么不在-loader-中清零-bss" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p><strong>A</strong>:</p>
<ol>
  <li>Loader 只有 512 字节空间</li>
  <li>清零 BSS 需要知道 BSS 的确切位置和大小</li>
  <li>这会增加 Loader 的复杂性</li>
  <li>让内核自己处理更灵活</li>
</ol>

<h3 id="q2-bss_init-能在任何时候调用吗"><span class="me-2">Q2: bss_init() 能在任何时候调用吗？</span><a href="#q2-bss_init-能在任何时候调用吗" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p><strong>A</strong>: 
<strong>不能！</strong> 必须是第一个调用的初始化函数：</p>
<ul>
  <li>在它之前不能使用任何全局变量</li>
  <li>很多子系统依赖全局变量为 0</li>
  <li>甚至 printf 都可能使用全局状态</li>
</ul>

<h3 id="q3-静态局部变量在-bss-中吗"><span class="me-2">Q3: 静态局部变量在 BSS 中吗？</span><a href="#q3-静态局部变量在-bss-中吗" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p><strong>A</strong>:</p>
<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">counter</span><span class="p">;</span>  <span class="c1">// 在 .bss</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// 在 .data</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>静态局部变量的存储方式与全局变量相同，只是名字可见性不同。</p>

<h3 id="q4-如果-bss-特别大会怎样"><span class="me-2">Q4: 如果 BSS 特别大会怎样？</span><a href="#q4-如果-bss-特别大会怎样" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p><strong>A</strong>: 
<code class="language-plaintext highlighter-rouge">memset</code> 会花更长时间，但通常不是问题：</p>
<ul>
  <li>现代 CPU 的内存带宽很高</li>
  <li>几 MB 的清零只需要毫秒级</li>
  <li>内核 BSS 通常不会太大</li>
</ul>

<hr />

<h2 id="调试技巧"><span class="me-2">调试技巧</span><a href="#调试技巧" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="查看-bss-段信息"><span class="me-2">查看 BSS 段信息</span><a href="#查看-bss-段信息" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c"># 使用 nm 查看符号</span>
nm kernel.o | <span class="nb">grep</span> <span class="s2">"_bss"</span>
<span class="c"># 输出：</span>
<span class="c"># c0021000 B _start_bss</span>
<span class="c"># c0022000 B _end_bss</span>

<span class="c"># 使用 size 查看段大小</span>
size kernel.o
<span class="c">#    text    data     bss     dec     hex filename</span>
<span class="c">#   40000    4000    4096   48096    bc00 kernel.o</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="在-gdb-中检查"><span class="me-2">在 GDB 中检查</span><a href="#在-gdb-中检查" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<pre><code class="language-gdb">(gdb) p &amp;_start_bss
$1 = 0xc0021000
(gdb) p &amp;_end_bss
$2 = 0xc0022000
(gdb) p &amp;_end_bss - &amp;_start_bss
$3 = 4096

# 检查 BSS 是否已清零
(gdb) x/10x &amp;_start_bss
0xc0021000: 0x00000000 0x00000000 0x00000000 0x00000000
</code></pre>

<hr />

<h2 id="练习思考"><span class="me-2">练习思考</span><a href="#练习思考" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="思考题-1"><span class="me-2">思考题 1</span><a href="#思考题-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>如果在 bss_init() 中不小心写成：</p>
<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">memset</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">_start_bss</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_start_bss</span> <span class="o">-</span> <span class="o">&amp;</span><span class="n">_end_bss</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>
<p>会发生什么？</p>

<details>
<summary>点击查看答案</summary>

参数顺序错了，计算结果是负数：
```c
&amp;_start_bss - &amp;_end_bss  // 负数！

// memset 的第三个参数是 size_t（无符号）
// 负数会被解释为非常大的正数
// 例如：-4096 → 0xFFFFF000（约 4GB）

// memset 会尝试清零约 4GB 内存
// 这会覆盖整个内核代码和其他数据
// 系统立即崩溃
```

</details>

<h3 id="思考题-2"><span class="me-2">思考题 2</span><a href="#思考题-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>如果有一个全局变量初始化为 0：</p>
<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kt">int</span> <span class="n">zero_var</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>它应该在 .data 还是 .bss？编译器如何决定？</p>

<details>
<summary>点击查看答案</summary>

这取决于编译器的优化：

1. **严格来说**：变量有初始值，应该在 .data
2. **优化后**：很多编译器会将初始化为 0 的变量放入 .bss

编译器的决定因素：
- `-fno-zero-initialized-in-bss`：强制放入 .data
- 默认行为：通常优化到 .bss

验证方法：
```bash
gcc -c -S test.c -o test.s
# 查看汇编输出中变量的段
```

</details>

<h3 id="思考题-3"><span class="me-2">思考题 3</span><a href="#思考题-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>为什么 bss_init 要用 memset 而不是简单的循环？</p>

<details>
<summary>点击查看答案</summary>

实际上，Pintos 的 memset 就是简单循环。但使用 memset 有好处：

1. **可读性**：意图更清晰
2. **可移植性**：memset 是标准函数
3. **潜在优化**：高质量的 libc 实现有优化版本
4. **代码复用**：memset 在其他地方也会用到

如果要手写循环：
```c
for (char *p = &_start_bss; p &lt; &_end_bss; p++)
    *p = 0;
```

但这不如 `memset` 简洁。

</details>

<hr />

<h2 id="下一步"><span class="me-2">下一步</span><a href="#下一步" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>BSS 清零后，内核需要读取和解析命令行参数。下一篇文档将介绍命令行处理：<a href="2026-01-22-pintos-kernel-09-command-line.md">命令行解析</a></p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>,
          <a href="/categories/pintos/">Pintos</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/os/"
            class="post-tag no-text-decoration"
          >OS</a>
        
          <a
            href="/tags/pintos/"
            class="post-tag no-text-decoration"
          >Pintos</a>
        
          <a
            href="/tags/c%E8%AF%AD%E8%A8%80/"
            class="post-tag no-text-decoration"
          >C语言</a>
        
          <a
            href="/tags/bss/"
            class="post-tag no-text-decoration"
          >BSS</a>
        
          <a
            href="/tags/%E9%93%BE%E6%8E%A5%E5%99%A8/"
            class="post-tag no-text-decoration"
          >链接器</a>
        
          <a
            href="/tags/%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80/"
            class="post-tag no-text-decoration"
          >内存布局</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          本文由作者按照 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         进行授权
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">分享</span>
  <span class="share-icons">
    
    
    

    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="分享链接"
      data-title-succeed="链接已复制！"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">最近更新</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/pintos-thread-03-create/">Pintos 线程系统详解（三）：线程创建</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/pintos-thread-04-schedule/">Pintos 线程系统详解（四）：线程调度</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/pintos-thread-05-switch/">Pintos 线程系统详解（五）：上下文切换</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/pintos-thread-06-block-unblock/">Pintos 线程系统详解（六）：阻塞与唤醒</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/pintos-thread-07-semaphore/">Pintos 线程系统详解（七）：信号量</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/os/">OS</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/pintos/">Pintos</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E6%B1%87%E7%BC%96/">汇编</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E5%BC%95%E5%AF%BC%E5%8A%A0%E8%BD%BD%E7%A8%8B%E5%BA%8F/">引导加载程序</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E7%BA%BF%E7%A8%8B/">线程</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E5%86%85%E6%A0%B8/">内核</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E5%90%8C%E6%AD%A5/">同步</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c%E8%AF%AD%E8%A8%80/">C语言</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/gdt/">GDT</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/x86/">x86</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">文章内容</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">相关文章</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/pintos-kernel-09-command-line/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1769011200"
  data-df="YYYY/MM/DD"
  
>
  2026/01/22
</time>

              <h4 class="pt-0 my-2">Pintos Kernel 启动详解（九）：命令行解析</h4>
              <div class="text-muted">
                <p>详细解析 Pintos 如何读取和解析内核命令行参数，包括参数传递机制和选项处理。</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/pintos-kernel-07-pintos-init/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1769011200"
  data-df="YYYY/MM/DD"
  
>
  2026/01/22
</time>

              <h4 class="pt-0 my-2">Pintos Kernel 启动详解（七）：pintos_init 主函数</h4>
              <div class="text-muted">
                <p>详细解析 Pintos 内核的 C 语言入口函数 pintos_init()，包括初始化流程和各子系统的启动顺序。</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/pintos-loader-07-puts-function/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1768924800"
  data-df="YYYY/MM/DD"
  
>
  2026/01/21
</time>

              <h4 class="pt-0 my-2">Pintos Loader.S 详解（七）：puts 函数</h4>
              <div class="text-muted">
                <p>Pintos 引导加载程序中 puts 函数的巧妙实现——字符串直接跟在 call 指令后面。</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/pintos-kernel-07-pintos-init/"
      class="btn btn-outline-primary"
      aria-label="上一篇"
    >
      <p>Pintos Kernel 启动详解（七）：pintos_init 主函数</p>
    </a>
  

  
    <a
      href="/posts/pintos-kernel-09-command-line/"
      class="btn btn-outline-primary"
      aria-label="下一篇"
    >
      <p>Pintos Kernel 启动详解（九）：命令行解析</p>
    </a>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2026</time>

    
      <a href="https://github.com/zxsheather">Zxsheather</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。"
      >保留部分权利。</span>
    
  </p>

  <p>本站采用 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 主题 <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.4.1"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a>
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/os/">OS</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/pintos/">Pintos</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E6%B1%87%E7%BC%96/">汇编</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E5%BC%95%E5%AF%BC%E5%8A%A0%E8%BD%BD%E7%A8%8B%E5%BA%8F/">引导加载程序</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E7%BA%BF%E7%A8%8B/">线程</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E5%86%85%E6%A0%B8/">内核</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E5%90%8C%E6%AD%A5/">同步</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c%E8%AF%AD%E8%A8%80/">C语言</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/gdt/">GDT</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/x86/">x86</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">发现新版本的内容。</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      更新
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">搜索结果为空</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

